<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üß∏ Catch My Hugs ‚Äî For Mim</title>
  <style>
    :root{
      --bg1:#0b1020; --bg2:#161a2b; --txt:#eef1ff; --mut:#b8c0ff;
      --accent:#ff5b8a; --gold:#ffbe4f;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0; min-height:100vh; color:var(--txt);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(900px 480px at 18% 0%, #2a3566 0%, transparent 58%),
        radial-gradient(900px 520px at 82% 20%, #6b2d52 0%, transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex; align-items:center; justify-content:center; padding:14px;
      overscroll-behavior: none;
      touch-action: none;
    }
    .wrap{
      width:min(920px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.12);
      border-radius:22px;
      box-shadow: 0 18px 70px rgba(0,0,0,.55);
      overflow:hidden;
    }
    header{
      padding:12px 14px 10px;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      flex-wrap:wrap;
    }
    .title{ display:flex; flex-direction:column; gap:4px; }
    h1{ margin:0; font-size:18px; letter-spacing:.2px; }
    .sub{ margin:0; color:var(--mut); font-size:13px; line-height:1.35; }
    .topRight{
      display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end;
    }
    .pill{
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      padding:8px 10px; border-radius:999px;
      font-weight:900; font-size:13px;
      display:flex; gap:8px; align-items:center;
      user-select:none;
    }
    .hearts{
      display:flex; gap:6px; align-items:center; padding:8px 10px;
      border-radius:999px; background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      user-select:none;
      font-weight:900; font-size:13px;
    }
    .hearts span{ font-size:16px; line-height:1; }

    .bar{
      display:flex; gap:10px; align-items:center; padding:0 14px 12px;
      flex-wrap:wrap;
    }
    .btn{
      appearance:none; border:none; cursor:pointer;
      padding:10px 12px; border-radius:14px; font-weight:1000;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      color:var(--txt);
    }
    .btn:active{ transform: scale(.99); }
    .btn.primary{
      background: linear-gradient(135deg, var(--accent), var(--gold));
      color:#1a1020; border:none;
    }
    .btn.on{
      outline: 2px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.14);
    }
    .hint{ color:var(--mut); font-size:13px; }
    .gameArea{
      position:relative;
      background: rgba(0,0,0,.18);
      border-top:1px solid rgba(255,255,255,.10);
    }
    canvas{
      display:block;
      width:100%;
      height:62vh;
      max-height:620px;
      touch-action:none;
    }
    .overlayMsg{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      pointer-events:none;
      font-weight:1000; font-size:22px;
      text-shadow: 0 10px 30px rgba(0,0,0,.65);
      opacity:0; transform: translateY(6px);
      transition: opacity .18s ease, transform .18s ease;
      padding:18px; text-align:center;
    }
    .overlayMsg.show{ opacity:1; transform: translateY(0); }

    .modal{
      position:fixed; inset:0;
      display:none; align-items:center; justify-content:center;
      background: rgba(0,0,0,.65);
      padding:16px;
    }
    .modalBox{
      width:min(560px, 100%);
      background: #0e1426;
      border:1px solid rgba(255,255,255,.14);
      border-radius:18px;
      padding:16px;
      box-shadow: 0 18px 80px rgba(0,0,0,.65);
    }
    .modalBox h2{ margin:0 0 8px; font-size:20px; }
    .modalBox p{ margin:0 0 10px; color:var(--mut); line-height:1.6; white-space:pre-wrap; }
    .modalRow{ display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; margin-top:12px; }
    .strong{ color:var(--txt); font-weight:1000; }
  </style>
</head>

<body>
  <div class="wrap" id="wrap">
    <header>
      <div class="title">
        <h1>üß∏ Catch My Hugs, Mim</h1>
        <p class="sub">Drag to move. Catch üß∏ = hug ‚ù§Ô∏è. Miss = lose a heart. Princess mode üë∏üß∫ ‚Ä¢ Made by <span class="strong">Turjo</span>.</p>
      </div>

      <div class="topRight">
        <div class="pill">‚ù§Ô∏è Hugs: <span id="score">0</span></div>
        <div class="hearts">Health:
          <span id="h1">‚ù§Ô∏è</span><span id="h2">‚ù§Ô∏è</span><span id="h3">‚ù§Ô∏è</span><span id="h4">‚ù§Ô∏è</span><span id="h5">‚ù§Ô∏è</span>
        </div>
      </div>
    </header>

    <div class="bar">
      <button class="btn primary" id="startBtn">Start</button>
      <button class="btn" id="resetBtn">Reset</button>
      <button class="btn" id="musicBtn">Music: Off</button>
      <button class="btn" id="fsBtn">Fullscreen</button>
      <span class="hint">Mobile: drag your finger left/right. (Sound needs phone unmuted.)</span>
    </div>

    <div class="gameArea">
      <div class="overlayMsg" id="msg"></div>
      <canvas id="c"></canvas>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modalBox">
      <h2 id="modalTitle">Game Over</h2>
      <p id="modalText"></p>
      <div class="modalRow">
        <button class="btn" id="closeBtn">Close</button>
        <button class="btn primary" id="playAgainBtn">Play Again</button>
      </div>
    </div>
  </div>

<script>
(() => {
  // ---------- Canvas / HiDPI ----------
  const canvas = document.getElementById("c");
  const ctx = canvas.getContext("2d");
  function resize(){
    const rect = canvas.getBoundingClientRect();
    const dpr = Math.max(1, window.devicePixelRatio || 1);
    canvas.width = Math.floor(rect.width * dpr);
    canvas.height = Math.floor(rect.height * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener("resize", resize);

  // ---------- UI ----------
  const scoreEl = document.getElementById("score");
  const msgEl = document.getElementById("msg");
  const startBtn = document.getElementById("startBtn");
  const resetBtn = document.getElementById("resetBtn");
  const musicBtn = document.getElementById("musicBtn");
  const fsBtn = document.getElementById("fsBtn");

  const modal = document.getElementById("modal");
  const modalTitle = document.getElementById("modalTitle");
  const modalText = document.getElementById("modalText");
  const closeBtn = document.getElementById("closeBtn");
  const playAgainBtn = document.getElementById("playAgainBtn");

  const heartEls = [
    document.getElementById("h1"),
    document.getElementById("h2"),
    document.getElementById("h3"),
    document.getElementById("h4"),
    document.getElementById("h5"),
  ];

  function showMsg(text){
    msgEl.textContent = text;
    msgEl.classList.add("show");
    clearTimeout(showMsg._t);
    showMsg._t = setTimeout(()=> msgEl.classList.remove("show"), 650);
  }

  function setHearts(n){
    for(let i=0;i<5;i++){
      heartEls[i].textContent = i < n ? "‚ù§Ô∏è" : "üñ§";
    }
  }

  // ---------- Fullscreen ----------
  async function requestFS(){
    const el = document.getElementById("wrap");
    try{
      if(!document.fullscreenElement && el.requestFullscreen){
        await el.requestFullscreen();
      }
    }catch(e){ /* ignore */ }
  }
  fsBtn.addEventListener("click", requestFS);

  // ---------- Vibration ----------
  function vibe(ms){
    try{ if(navigator.vibrate) navigator.vibrate(ms); } catch(e){}
  }

  // ---------- Background music (WebAudio chord loop, no external file) ----------
  let audioCtx = null;
  let musicOn = false;
  let musicTimer = null;
  let master = null;

  function ensureAudio(){
    if(!audioCtx){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      master = audioCtx.createGain();
      master.gain.value = 0.0;
      master.connect(audioCtx.destination);
    }
  }

  function playChord(freqs, duration=1.6){
    if(!audioCtx || !master) return;
    const now = audioCtx.currentTime;

    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(0.0, now);
    gain.gain.linearRampToValueAtTime(0.12, now + 0.08);
    gain.gain.linearRampToValueAtTime(0.0, now + duration);
    gain.connect(master);

    freqs.forEach(f => {
      const osc = audioCtx.createOscillator();
      osc.type = "sine";
      osc.frequency.setValueAtTime(f, now);
      osc.connect(gain);
      osc.start(now);
      osc.stop(now + duration + 0.05);
    });
  }

  const prog = [
    [261.63, 329.63, 392.00], // C
    [293.66, 369.99, 440.00], // Dm-ish
    [329.63, 415.30, 493.88], // Em-ish
    [349.23, 440.00, 523.25], // F-ish
  ];
  let progIdx = 0;

  function startMusic(){
    ensureAudio();
    audioCtx.resume?.();

    const now = audioCtx.currentTime;
    master.gain.cancelScheduledValues(now);
    master.gain.setValueAtTime(master.gain.value, now);
    master.gain.linearRampToValueAtTime(0.9, now + 0.25);

    clearInterval(musicTimer);
    progIdx = 0;
    musicTimer = setInterval(() => {
      playChord(prog[progIdx], 1.7);
      progIdx = (progIdx + 1) % prog.length;
    }, 1700);

    musicOn = true;
    musicBtn.textContent = "Music: On";
    musicBtn.classList.add("on");
  }

  function stopMusic(){
    if(!audioCtx || !master) return;
    const now = audioCtx.currentTime;
    master.gain.cancelScheduledValues(now);
    master.gain.setValueAtTime(master.gain.value, now);
    master.gain.linearRampToValueAtTime(0.0, now + 0.25);

    clearInterval(musicTimer);
    musicTimer = null;

    musicOn = false;
    musicBtn.textContent = "Music: Off";
    musicBtn.classList.remove("on");
  }

  musicBtn.addEventListener("click", () => {
    if(musicOn) stopMusic();
    else startMusic();
  });

  // ---------- Game ----------
  let running = false;
  let score = 0;
  let health = 5;

  // Princess catcher: emoji render + collision box
  // w/h are collision box sizes (not emoji font size)
  const basket = { x: 0, y: 0, w: 70, h: 42 };

  let teddies = [];
  let lastSpawn = 0;

  // Difficulty (normal -> harder)
  let spawnEvery = 900;    // ms decreases
  let baseSpeed = 2.2;     // increases
  let speedBoost = 0;      // increases
  let lastTime = 0;

  function resetGame(){
    teddies = [];
    score = 0;
    health = 5;
    spawnEvery = 900;
    baseSpeed = 2.2;
    speedBoost = 0;
    lastSpawn = 0;
    scoreEl.textContent = score;
    setHearts(health);
    running = false;
    startBtn.textContent = "Start";
    showMsg("Ready when you are üß∏");
    draw();
  }

  function spawnTeddy(){
    const w = canvas.getBoundingClientRect().width;
    const speed = baseSpeed + (Math.random()*1.4) + speedBoost;
    teddies.push({
      x: Math.random() * (w - 30),
      y: -50,
      vy: speed
    });
  }

  function makeHarder(){
    if(score % 5 === 0){
      spawnEvery = Math.max(420, spawnEvery - 50);
      speedBoost = Math.min(3.2, speedBoost + 0.28);
      if(score === 10) showMsg("Harder mode ‡¶∂‡ßÅ‡¶∞‡ßÅ üî• (Level up!)");
      else if(score === 20) showMsg("‡¶è‡¶ñ‡¶® ‡¶§‡ßã ‡¶§‡ßÅ‡¶Æ‡¶ø pro üòÑ Keep going!");
    }
  }

  function gameOver(){
    running = false;
    startBtn.textContent = "Start";

    const bangla = `Mim, ‡¶§‡ßÅ‡¶Æ‡¶ø ${score}‡¶ü‡¶æ hug ‡¶ß‡¶∞‡ßá‡¶õ‡ßã! üß∏‚ù§Ô∏è`;
    const english = `You caught ${score} hugs. I‚Äôm proud of you.`;

    modalTitle.textContent = "Game Over üñ§";
    modalText.textContent =
      `${bangla}  ${english}\n\n` +
      `Turjo ‡¶¨‡¶≤‡¶õ‡ßá: ‚Äú‡¶è‡¶¨‡¶æ‡¶∞ WhatsApp ‡¶è ‡¶≤‡¶ø‡¶ñ‡ßã‚Äî I caught them all!‚Äù`;
    modal.style.display = "flex";
  }

  function addScore(){
    score++;
    scoreEl.textContent = score;
    vibe(40);

    if(score === 10) showMsg("10 hugs delivered ü§ó");
    else if(score === 20) showMsg("20 hugs! Message me: ‚ÄúI caught them all.‚Äù ‚ù§Ô∏è");
    else {
      const lines = ["Hug sent ü§ó","Delivered üß∏","Miss you ‚ù§Ô∏è","Another hug"];
      showMsg(lines[Math.floor(Math.random()*lines.length)]);
    }
    makeHarder();
  }

  function loseHeart(){
    health--;
    setHearts(health);
    vibe(80);
    if(health <= 0){
      showMsg("No hearts left üñ§");
      gameOver();
    }else{
      showMsg(`Miss! Heart lost üíî (${health} left)`);
    }
  }

  function update(now){
    if(!running) return;

    if(now - lastSpawn > spawnEvery){
      spawnTeddy();
      lastSpawn = now;
    }

    const h = canvas.getBoundingClientRect().height;

    for(let i = teddies.length - 1; i >= 0; i--){
      const t = teddies[i];
      t.y += t.vy;

      // collision area inside princess+basket emoji
      const hitX1 = basket.x + 14;
      const hitX2 = basket.x + 14 + basket.w;
      const hitY1 = basket.y + 10;
      const hitY2 = basket.y + 10 + basket.h;

      const inX = (t.x + 14) > hitX1 && (t.x + 14) < hitX2;
      const inY = (t.y + 20) > hitY1 && (t.y + 20) < hitY2;

      if(inX && inY){
        teddies.splice(i,1);
        addScore();
        continue;
      }

      if(t.y > h + 70){
        teddies.splice(i,1);
        loseHeart();
      }
    }
  }

  function draw(){
    const w = canvas.getBoundingClientRect().width;
    const h = canvas.getBoundingClientRect().height;

    ctx.clearRect(0,0,w,h);

    // stars
    ctx.globalAlpha = 0.22;
    for(let i=0;i<44;i++){
      const x = (i*97)%w;
      const y = (i*53)%h;
      ctx.fillRect(x, y, 2, 2);
    }
    ctx.globalAlpha = 1;

    // Princess catcher (emoji)
    basket.y = h - 70;
    ctx.font = "46px system-ui, Apple Color Emoji, Segoe UI Emoji";
    ctx.textAlign = "left";
    ctx.fillText("üë∏üß∫", basket.x, basket.y + 46);

    // Teddies
    ctx.font = "30px system-ui, Apple Color Emoji, Segoe UI Emoji";
    for(const t of teddies){
      ctx.fillText("üß∏", t.x, t.y);
    }

    // Idle prompt
    if(!running){
      ctx.font = "16px system-ui";
      ctx.fillStyle = "rgba(255,255,255,.78)";
      ctx.textAlign = "center";
      ctx.fillText("Tap Start, then catch teddies to collect hugs ‚ù§Ô∏è", w/2, h/2);
      ctx.textAlign = "left";
    }
  }

  function loop(now){
    if(!lastTime) lastTime = now;
    update(now);
    draw();
    requestAnimationFrame(loop);
  }

  // Controls
  function setBasketX(clientX){
    const rect = canvas.getBoundingClientRect();
    const x = clientX - rect.left;
    // keep emoji within bounds (tweak margin for emoji width)
    const minX = 8;
    const maxX = rect.width - 110;
    basket.x = Math.max(minX, Math.min(maxX, x - 55));
  }

  canvas.addEventListener("mousemove", (e)=> setBasketX(e.clientX));
  canvas.addEventListener("touchstart", (e)=> { e.preventDefault(); setBasketX(e.touches[0].clientX); }, {passive:false});
  canvas.addEventListener("touchmove", (e)=> { e.preventDefault(); setBasketX(e.touches[0].clientX); }, {passive:false});

  // Buttons
  startBtn.addEventListener("click", async () => {
    await requestFS();           // auto fullscreen attempt
    if(musicOn && audioCtx) audioCtx.resume?.(); // ensure audio on mobile

    running = !running;
    startBtn.textContent = running ? "Pause" : "Start";
    showMsg(running ? "Go! Catch the hugs ü§ó" : "Paused üß∏");
  });

  resetBtn.addEventListener("click", resetGame);

  // Modal
  function closeModal(){ modal.style.display = "none"; }
  closeBtn.addEventListener("click", closeModal);
  playAgainBtn.addEventListener("click", () => {
    closeModal();
    resetGame();
    showMsg("Princess mode ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶∞‡ßÅ üë∏üß∫");
  });
  modal.addEventListener("click", (e) => { if(e.target === modal) closeModal(); });

  // Start
  resize();
  resetGame();
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
